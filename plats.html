<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<title>Qook ‚Äì Recettes</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{ 
  --bg:#f7f8fa; 
  --card:#fff; 
  --accent:#15b79a; 
  --accent-2:#0f9e85; 
  --muted:#6c7780; 
  --danger:#e74c3c; 
  --orange:#ff6347;
  --yellow:#ffc107;
  --green:#4caf50;
  --blue:#2196f3;
  --radius:18px;
}

* {
  box-sizing:border-box;
  -webkit-tap-highlight-color: transparent;
}

body,html {
  height:100%;
  margin:0;
  font-family:"Outfit",system-ui,-apple-system,"Segoe UI",Roboto,Arial;
  -webkit-font-smoothing: antialiased;
  -webkit-text-size-adjust: 100%;
}

body {
  background:#ffffff;
  color:#132a31;
  padding-bottom:calc(24px + env(safe-area-inset-bottom));
  padding-top:env(safe-area-inset-top);
}

.app {
  max-width:900px;
  margin:18px auto;
  padding:0 16px;
}

header {
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  margin-bottom:16px;
  flex-wrap:wrap;
}

.brand {
  display:flex;
  gap:12px;
  align-items:center;
  flex:1;
  min-width:250px;
}

h1 {
  font-size:22px;
  margin:0;
  font-weight:700;
}

.hint {
  font-size:13px;
  color:var(--muted);
  margin:4px 0 0 0;
  line-height:1.4;
}

/* Filtres */
.filters-section {
  margin-bottom:20px;
}

.filters-row {
  display:flex;
  gap:10px;
  margin-bottom:12px;
  overflow-x:auto;
  -webkit-overflow-scrolling:touch;
  padding:4px;
  scrollbar-width: none;
  scroll-snap-type: x proximity;
}

.filters-row::-webkit-scrollbar {
  display:none;
}

.filter-btn {
  padding:8px 18px;
  border-radius:20px;
  border:1px solid #e0e0e0;
  background:#fff;
  color:#666;
  font-weight:500;
  cursor:pointer;
  font-size:13px;
  transition:all 0.3s;
  white-space:nowrap;
  flex-shrink:0;
  scroll-snap-align: start;
  display:flex;
  align-items:center;
  gap:6px;
}

.filter-btn:hover {
  transform:translateY(-2px);
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
}

.filter-btn.active {
  background:var(--orange);
  color:#fff;
  border-color:var(--orange);
}

.categories-bar {
  display:flex;
  gap:10px;
  margin-bottom:20px;
  overflow-x:auto;
  -webkit-overflow-scrolling:touch;
  padding:4px;
  scrollbar-width: none;
  scroll-snap-type: x proximity;
}

.categories-bar::-webkit-scrollbar {
  display:none;
}

.cat-btn {
  padding:10px 24px;
  border-radius:24px;
  border:1px solid #e0e0e0;
  background:#fff;
  color:#333;
  font-weight:500;
  cursor:pointer;
  font-size:14px;
  transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  white-space:nowrap;
  flex-shrink:0;
  scroll-snap-align: start;
}

.cat-btn:hover {
  transform:translateY(-2px);
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
}

.cat-btn.active {
  background:var(--orange);
  color:#fff;
  border-color:var(--orange);
  box-shadow:0 4px 12px rgba(255,99,71,0.25);
}

.recettes-list {
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(280px, 1fr));
  gap:16px;
}

.recette-card {
  background:#fff;
  border-radius:16px;
  box-shadow:0 2px 12px rgba(0,0,0,0.06);
  border:1px solid #f0f0f0;
  overflow:hidden;
  transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position:relative;
  cursor:pointer;
}

.recette-card:hover {
  transform:translateY(-4px);
  box-shadow:0 8px 24px rgba(0,0,0,0.12);
}

.recette-card:active {
  transform:scale(0.98);
}

.recette-img-container {
  position:relative;
  width:100%;
  height:180px;
  overflow:hidden;
}

.recette-img {
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
  transition:transform 0.5s ease;
}

.recette-card:hover .recette-img {
  transform:scale(1.1);
}

.recipe-badge {
  position:absolute;
  top:12px;
  left:12px;
  background:rgba(255,255,255,0.95);
  padding:6px 14px;
  border-radius:20px;
  font-size:12px;
  font-weight:600;
  color:#333;
  backdrop-filter:blur(4px);
}

.recette-content {
  padding:14px 16px;
}

.recette-title {
  font-size:16px;
  font-weight:700;
  color:#1a1a1a;
  margin:0 0 8px;
  line-height:1.4;
}

.recette-meta {
  display:flex;
  align-items:center;
  gap:16px;
  margin-bottom:12px;
  font-size:13px;
  color:#666;
}

.rating {
  display:flex;
  align-items:center;
  gap:4px;
  color:#ffa500;
  font-weight:600;
}

.recette-macros {
  font-size:13px;
  color:var(--accent);
  margin-bottom:12px;
  font-weight:500;
}

#searchBar {
  width:100%;
  padding:14px 18px;
  margin-bottom:16px;
  border-radius:28px;
  border:1px solid #e0e0e0;
  font-size:15px;
  background:#fff;
  -webkit-appearance:none;
  transition:all 0.3s ease;
}

#searchBar:focus {
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 3px rgba(21,183,154,0.1);
}

.suggestions-carousel {
  display:flex;
  overflow-x:auto;
  gap:14px;
  margin-bottom:20px;
  padding:4px;
  scroll-behavior:smooth;
  -webkit-overflow-scrolling:touch;
  scrollbar-width: none;
  scroll-snap-type: x proximity;
}

.suggestions-carousel::-webkit-scrollbar {
  display:none;
}

.suggestion-card {
  flex:0 0 auto;
  width:160px;
  background:#fff;
  border-radius:14px;
  box-shadow:0 2px 10px rgba(0,0,0,0.06);
  border:1px solid #f0f0f0;
  cursor:pointer;
  transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  overflow:hidden;
  scroll-snap-align: start;
}

.suggestion-card:hover {
  transform:translateY(-4px);
  box-shadow:0 8px 20px rgba(0,0,0,0.12);
}

.suggestion-card:active {
  transform:scale(0.95);
}

.suggestion-card img {
  width:100%;
  height:100px;
  object-fit:cover;
  display:block;
}

.suggestion-card .suggestion-title {
  padding:10px;
  font-weight:600;
  font-size:13px;
  color:#1a1a1a;
  line-height:1.3;
}

.ghost {
  background:transparent;
  color:var(--accent);
  border:1px solid var(--accent);
  padding:10px 16px;
  border-radius:10px;
  text-decoration:none;
  font-weight:600;
  font-size:15px;
  transition:all 0.2s;
}

.ghost:active {
  transform:scale(0.95);
}

#loader {
  width:56px;
  height:56px;
  border-radius:50%;
  border:6px solid #f0f0f0;
  border-top:6px solid var(--orange);
  animation: spin 0.9s linear infinite;
  margin:48px auto;
  display:none;
}

@keyframes spin {
  to { transform:rotate(360deg); }
}

/* Modal */
.modal-overlay {
  position:fixed;
  top:0;
  left:0;
  right:0;
  bottom:0;
  background:rgba(0,0,0,0.7);
  z-index:1000;
  display:none;
  animation:fadeIn 0.3s ease;
}

.modal-overlay.active {
  display:flex;
  align-items:flex-start;
  justify-content:center;
  overflow-y:auto;
  padding:20px;
}

@keyframes fadeIn {
  from { opacity:0; }
  to { opacity:1; }
}

.modal-content {
  background:#fff;
  border-radius:20px;
  max-width:500px;
  width:100%;
  position:relative;
  animation:slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  margin:auto;
}

@keyframes slideUp {
  from { 
    opacity:0; 
    transform:translateY(50px) scale(0.9);
  }
  to { 
    opacity:1; 
    transform:translateY(0) scale(1);
  }
}

.modal-header {
  position:relative;
  padding:24px 20px 20px;
}

.modal-close {
  position:absolute;
  top:16px;
  right:16px;
  width:36px;
  height:36px;
  border-radius:50%;
  background:rgba(255,255,255,0.95);
  border:none;
  font-size:24px;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#333;
  backdrop-filter:blur(4px);
  transition:all 0.2s;
  z-index:10;
}

.modal-close:hover {
  transform:scale(1.1);
  background:#fff;
}

.modal-title {
  font-size:28px;
  font-weight:800;
  color:#1a1a1a;
  margin:0 0 12px 0;
  line-height:1.2;
  padding-right:40px;
}

.modal-tags {
  display:flex;
  gap:8px;
  margin-bottom:16px;
  flex-wrap:wrap;
}

.modal-tag {
  padding:6px 14px;
  border-radius:20px;
  font-size:13px;
  font-weight:600;
}

.tag-cuisine {
  background:#e3f2fd;
  color:#1976d2;
}

.tag-category {
  background:#fff3e0;
  color:#f57c00;
}

.modal-rating {
  display:flex;
  align-items:center;
  gap:8px;
  margin-bottom:20px;
}

.rating-stars {
  color:#ffa500;
  font-size:18px;
  font-weight:700;
}

.rating-text {
  color:#666;
  font-size:14px;
}

.modal-image {
  width:100%;
  height:220px;
  object-fit:cover;
  border-radius:16px;
  margin-bottom:20px;
}

.modal-description {
  font-size:14px;
  color:#666;
  line-height:1.6;
  margin-bottom:20px;
}

.view-more {
  color:var(--orange);
  font-weight:600;
  cursor:pointer;
}

.macros-grid {
  display:grid;
  grid-template-columns:repeat(4, 1fr);
  gap:12px;
  margin-bottom:24px;
}

.macro-item {
  text-align:center;
  position:relative;
}

.macro-circle {
  width:70px;
  height:70px;
  margin:0 auto 8px;
  position:relative;
}

.macro-circle svg {
  transform:rotate(-90deg);
}

.macro-value {
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%, -50%);
  font-size:16px;
  font-weight:700;
  color:#1a1a1a;
}

.macro-label {
  font-size:12px;
  color:#666;
  font-weight:500;
}

.modal-tabs {
  display:flex;
  gap:12px;
  margin-bottom:20px;
  border-bottom:2px solid #f0f0f0;
}

.modal-tab {
  padding:12px 24px;
  border:none;
  background:transparent;
  color:#666;
  font-weight:600;
  font-size:15px;
  cursor:pointer;
  transition:all 0.3s;
  border-bottom:3px solid transparent;
  margin-bottom:-2px;
}

.modal-tab.active {
  color:var(--orange);
  border-bottom-color:var(--orange);
}

.modal-body {
  padding:0 20px 24px;
}

.tab-content {
  display:none;
}

.tab-content.active {
  display:block;
  animation:fadeInContent 0.3s ease;
}

@keyframes fadeInContent {
  from { opacity:0; transform:translateY(10px); }
  to { opacity:1; transform:translateY(0); }
}

.ingredient-item {
  display:flex;
  align-items:center;
  gap:12px;
  padding:14px;
  background:#fff;
  border-radius:12px;
  margin-bottom:10px;
  border:1px solid #f0f0f0;
}

.ingredient-icon {
  width:36px;
  height:36px;
  font-size:24px;
  display:flex;
  align-items:center;
  justify-content:center;
}

.ingredient-info {
  flex:1;
}

.ingredient-name {
  font-size:15px;
  font-weight:600;
  color:#1a1a1a;
  margin-bottom:2px;
}

.ingredient-quantity {
  font-size:13px;
  color:#999;
  text-align:right;
  font-weight:500;
}

.instruction-item {
  margin-bottom:20px;
}

.instruction-header {
  display:flex;
  align-items:flex-start;
  gap:12px;
  margin-bottom:10px;
}

.instruction-number {
  width:32px;
  height:32px;
  background:var(--orange);
  color:#fff;
  border-radius:8px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
  font-size:16px;
  flex-shrink:0;
}

.instruction-text {
  flex:1;
  font-size:14px;
  color:#333;
  line-height:1.6;
  padding-top:4px;
}

/* iPhone et mobile */
@media (max-width:768px) {
  .app {
    padding:0 12px;
    margin:12px 0;
  }

  .recettes-list {
    grid-template-columns:1fr;
    gap:14px;
  }

  h1 {
    font-size:20px;
  }

  .hint {
    font-size:12px;
  }

  .modal-content {
    max-width:100%;
    border-radius:20px 20px 0 0;
    margin:auto auto 0;
  }

  .modal-title {
    font-size:24px;
  }

  .macros-grid {
    grid-template-columns:repeat(4, 1fr);
    gap:8px;
  }

  .macro-circle {
    width:60px;
    height:60px;
  }

  .macro-value {
    font-size:14px;
  }
}

@supports (padding: max(0px)) {
  body {
    padding-left: max(12px, env(safe-area-inset-left));
    padding-right: max(12px, env(safe-area-inset-right));
  }
}
</style>
</head>
<body>
<div class="app">
<header>
<div class="brand">
<div>
<h1>Recettes</h1>
<p class="hint">Retrouve ici un large choix de recettes</p>
</div>
</div>
<div style="display:flex;gap:8px">
<a href="home.html" class="ghost">Retour</a>
</div>
</header>

<main>
<section class="card">
<input type="text" id="searchBar" placeholder="üîç Rechercher une recette..."/>

<div class="filters-section">
  <div class="filters-row" id="cuisineFilters"></div>
  <div class="filters-row" id="categoryFilters"></div>
</div>

<div class="suggestions-carousel" id="suggestionsCarousel"></div>
<div class="categories-bar" id="categoriesBar"></div>
<div class="recettes-list" id="recettesList"></div>
<div id="loader"></div>
</section>
</main>
</div>

<!-- Modal -->
<div class="modal-overlay" id="recetteModal">
  <div class="modal-content">
    <div class="modal-header">
      <button class="modal-close" onclick="closeModal()">√ó</button>
      <h2 class="modal-title" id="modalTitle"></h2>
      <div class="modal-tags" id="modalTags"></div>
      <div class="modal-rating">
        <span class="rating-stars" id="modalRating">‚≠ê 4.4</span>
        <span class="rating-text">(6.4k ratings)</span>
      </div>
      <img class="modal-image" id="modalImage" src="" alt="Recipe"/>
      <p class="modal-description" id="modalDescription">
        A quick and flavorful dish made by whisking eggs and stir-frying them with light seasoning. 
        <span class="view-more">View More</span>
      </p>
    </div>

    <div class="macros-grid" id="modalMacros"></div>

    <div class="modal-tabs">
      <button class="modal-tab active" onclick="switchTab('ingredients')">Ingredients</button>
      <button class="modal-tab" onclick="switchTab('instructions')">Instructions</button>
    </div>

    <div class="modal-body">
      <div class="tab-content active" id="ingredientsTab"></div>
      <div class="tab-content" id="instructionsTab"></div>
    </div>
  </div>
</div>

<script>
let currentModalRecette = null;
let activeFilters = {
  cuisine: null,
  category: null,
  type: null
};

const cuisineTypes = ['Fran√ßaise', 'Italienne', 'Asiatique', 'Mexicaine', 'Indienne', 'M√©diterran√©enne'];
const categoryTypes = ['Entr√©e', 'Plat', 'Dessert', 'Boisson', 'Snack'];

const ingredientIcons = {
  'yaourt': 'ü•õ', 'ginger': 'üßÑ', 'lemon': 'üçã', 'chaat': 'üå∂Ô∏è', 'cumin': 'üåø',
  'garam': 'üå∂Ô∏è', 'red chili': 'üå∂Ô∏è', 'turmeric': 'üåø', 'salt': 'üßÇ', 'oil': 'ü´í',
  'yogurt': 'ü•õ', 'paste': 'üßÑ', 'juice': 'üçã', 'powder': 'üåø', 'ghee': 'ü´í'
};

function getIngredientIcon(ingredient) {
  const lower = ingredient.toLowerCase();
  for (const [key, icon] of Object.entries(ingredientIcons)) {
    if (lower.includes(key)) return icon;
  }
  return 'ü•Ñ';
}

function getFavList(){
  try{
    return JSON.parse(localStorage.getItem('sn_v2_fav_recipes')||'[]');
  }catch(e){
    return[];
  }
}

function setFavList(arr){
  try{
    localStorage.setItem('sn_v2_fav_recipes',JSON.stringify(arr));
  }catch(e){}
}

function isFav(nom){
  return getFavList().includes(nom);
}

function toggleFav(nom){
  let favs=getFavList();
  if(favs.includes(nom)){
    favs=favs.filter(f=>f!==nom);
  }else{
    favs.push(nom);
  }
  setFavList(favs);
  renderRecettesList(currentPlats);
}

function filtreNonVeg(list){
  return list.filter(r=>
    !(r.categorie&&r.categorie.toLowerCase().includes("v√©g√©tarien")||r.categorie.toLowerCase().includes("vegan"))&&
    !(r.nom&&r.nom.toLowerCase().includes("vegan"))&&
    !(r.type&&(r.type=="vegan"||r.type=="vegetarien"||r.type=="plat v√©g√©tarien"))&&
    typeof r.image=="string"&&r.image.length>0
  );
}

let currentPlats=null;

function renderFilters(){
  const cuisineBar = document.getElementById('cuisineFilters');
  const categoryBar = document.getElementById('categoryFilters');
  
  cuisineBar.innerHTML = '<button class="filter-btn'+(activeFilters.cuisine===null?' active':'')+'" onclick="filterByCuisine(null)">üåç Toutes cuisines</button>';
  cuisineTypes.forEach(cuisine => {
    cuisineBar.innerHTML += `<button class="filter-btn${activeFilters.cuisine===cuisine?' active':''}" onclick="filterByCuisine('${cuisine}')">${cuisine}</button>`;
  });
  
  categoryBar.innerHTML = '<button class="filter-btn'+(activeFilters.category===null?' active':'')+'" onclick="filterByCategory(null)">üçΩÔ∏è Toutes cat√©gories</button>';
  categoryTypes.forEach(cat => {
    const icons = {'Entr√©e':'ü•ó','Plat':'üçõ','Dessert':'üç∞','Boisson':'ü•§','Snack':'üçø'};
    categoryBar.innerHTML += `<button class="filter-btn${activeFilters.category===cat?' active':''}" onclick="filterByCategory('${cat}')">${icons[cat]||''} ${cat}</button>`;
  });
}

function filterByCuisine(cuisine){
  activeFilters.cuisine = cuisine;
  renderFilters();
  renderRecettesList(currentPlats);
}

function filterByCategory(category){
  activeFilters.category = category;
  renderFilters();
  renderRecettesList(currentPlats);
}

function renderCategoriesBar(categories,activeType){
  const bar=document.getElementById('categoriesBar');
  bar.innerHTML='';
  const allBtn = document.createElement('button');
  allBtn.className='cat-btn'+(activeType===null?' active':'');
  allBtn.textContent='Tous';
  allBtn.onclick=()=>{
    activeFilters.type = null;
    renderCategoriesBar(categories,null);
    renderRecettesList(currentPlats);
  };
  bar.appendChild(allBtn);
  
  categories.forEach(cat=>{
    const btn=document.createElement('button');
    btn.className='cat-btn'+(activeType===cat.type?' active':'');
    btn.dataset.type=cat.type;
    btn.textContent=cat.label;
    btn.onclick=()=>{
      activeFilters.type=btn.dataset.type;
      renderCategoriesBar(categories,activeFilters.type);
      renderRecettesList(currentPlats);
    };
    bar.appendChild(btn);
  });
}

function renderSuggestions(plats){
  const carousel=document.getElementById('suggestionsCarousel');
  carousel.innerHTML='';
  plats.slice(0,10).forEach(p=>{
    const card=document.createElement('div');
    card.className='suggestion-card';
    card.onclick=()=>openRecetteModal(p.nom);
    card.innerHTML=`<img src="${p.image}" alt="${p.nom}"/><div class="suggestion-title">${p.nom}</div>`;
    carousel.appendChild(card);
  });
}

function drawCircle(percent, color) {
  const radius = 30;
  const circumference = 2 * Math.PI * radius;
  const offset = circumference - (percent / 100) * circumference;
  
  return `
    <svg width="70" height="70">
      <circle cx="35" cy="35" r="${radius}" fill="none" stroke="#f0f0f0" stroke-width="6"/>
      <circle cx="35" cy="35" r="${radius}" fill="none" stroke="${color}" stroke-width="6" 
        stroke-dasharray="${circumference}" stroke-dashoffset="${offset}" stroke-linecap="round"/>
    </svg>
  `;
}

function switchTab(tab) {
  document.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  
  event.target.classList.add('active');
  document.getElementById(tab + 'Tab').classList.add('active');
}

function openRecetteModal(nom){
  const recette=currentPlats.find(r=>r.nom===nom);
  if(!recette)return;
  
  currentModalRecette = recette;
  
  document.getElementById('modalTitle').textContent=recette.nom;
  document.getElementById('modalImage').src=recette.image;
  
  const tagsHtml = `
    <span class="modal-tag tag-cuisine">üçΩÔ∏è ${recette.type || 'Plat'}</span>
    <span class="modal-tag tag-category">${recette.categorie}</span>
  `;
  document.getElementById('modalTags').innerHTML = tagsHtml;
  
  // Macros circulaires
  const macros = recette.macros || {cal:320, p:30, c:20, f:15};
  const macrosHtml = `
    <div class="macro-item">
      <div class="macro-circle">
        ${drawCircle(85, '#4caf50')}
        <div class="macro-value">${macros.cal}</div>
      </div>
      <div class="macro-label">Kcal</div>
    </div>
    <div class="macro-item">
      <div class="macro-circle">
        ${drawCircle(75, '#ff9800')}
        <div class="macro-value">${macros.c}g</div>
      </div>
      <div class="macro-label">Carbs</div>
    </div>
    <div class="macro-item">
      <div class="macro-circle">
        ${drawCircle(60, '#2196f3')}
        <div class="macro-value">${macros.p}g</div>
      </div>
      <div class="macro-label">Protein</div>
    </div>
    <div class="macro-item">
      <div class="macro-circle">
        ${drawCircle(45, '#f44336')}
        <div class="macro-value">${macros.f}g</div>
      </div>
      <div class="macro-label">Fat</div>
    </div>
  `;
  document.getElementById('modalMacros').innerHTML = macrosHtml;
  
  // Ingr√©dients
  const ingredientsHtml = recette.ingredients.map(ing => {
    const parts = ing.split('-');
    const name = parts[0].trim();
    const quantity = parts[1]?.trim() || '1 portion';
    return `
      <div class="ingredient-item">
        <div class="ingredient-icon">${getIngredientIcon(name)}</div>
        <div class="ingredient-info">
          <div class="ingredient-name">${name}</div>
        </div>
        <div class="ingredient-quantity">${quantity}</div>
      </div>
    `;
  }).join('');
  document.getElementById('ingredientsTab').innerHTML = ingredientsHtml;
  
  // Instructions
  const instructionsHtml = recette.etapes.map((step, i) => `
    <div class="instruction-item">
      <div class="instruction-header">
        <div class="instruction-number">${i + 1}</div>
        <div class="instruction-text">${step}</div>
      </div>
    </div>
  `).join('');
  document.getElementById('instructionsTab').innerHTML = instructionsHtml;
  
  document.getElementById('recetteModal').classList.add('active');
  document.body.style.overflow='hidden';
}

function closeModal(){
  document.getElementById('recetteModal').classList.remove('active');
  document.body.style.overflow='';
  currentModalRecette=null;
}

// Fermer modal en cliquant sur l'overlay
document.getElementById('recetteModal').addEventListener('click',(e)=>{
  if(e.target.id==='recetteModal')closeModal();
});

function renderRecettesList(list){
  const plats=filtreNonVeg(list);
  currentPlats=plats;
  const container=document.getElementById('recettesList');
  const searchTerm = document.getElementById('searchBar').value.toLowerCase();
  container.innerHTML='';
  
  let filtered=plats;
  
  // Appliquer filtres
  if(activeFilters.type) filtered=filtered.filter(r=>r.type===activeFilters.type);
  if(activeFilters.cuisine) filtered=filtered.filter(r=>r.cuisine===activeFilters.cuisine);
  if(activeFilters.category) filtered=filtered.filter(r=>r.categorie.includes(activeFilters.category));
  if(searchTerm) filtered=filtered.filter(r=>r.nom.toLowerCase().includes(searchTerm));
  
  filtered.forEach(recette=>{
    const macros=recette.macros?`${recette.macros.cal}kcal ‚Ä¢ ${recette.macros.p}g P ‚Ä¢ ${recette.macros.c}g C ‚Ä¢ ${recette.macros.f}g L`:'';
    const favActive=isFav(recette.nom)?'active':'';
    
    const card=document.createElement('div');
    card.className='recette-card';
    card.onclick=()=>openRecetteModal(recette.nom);
    card.innerHTML=`
      <div class="recette-img-container">
        <img src="${recette.image}" alt="${recette.nom}" class="recette-img" loading="lazy"/>
        <div class="recipe-badge">${recette.categorie}</div>
      </div>
      <div class="recette-content">
        <div class="recette-title">${recette.nom}</div>
        <div class="recette-meta">
          <div class="rating">
            <span>‚≠ê</span>
            <span>4.7</span>
            <span style="color:#999;font-weight:400">(7.4k)</span>
          </div>
        </div>
        ${recette.temps?`<div style="font-size:13px;color:#666;margin-bottom:8px">‚è± ${recette.temps} Min ‚Ä¢ üë§ 1 pers</div>`:''}
        <div class="recette-macros">${macros}</div>
      </div>
    `;
    container.appendChild(card);
  });
  
  renderSuggestions(filtered);
}

// Recherche
document.getElementById('searchBar').addEventListener('input',()=>renderRecettesList(currentPlats));

// Chargement JSON
document.getElementById('recettesList').style.display='none';
document.getElementById('loader').style.display='block';

fetch('recettes.json')
  .then(resp=>resp.json())
  .then(data=>{
    const recettes=filtreNonVeg(data);
    currentPlats=recettes;
    
    const categories=Object.entries(recettes.reduce((acc,r)=>{
      acc[r.categorie]=r.type;
      return acc;
    },{})).map(([label,type])=>({label,type}));
    
    renderFilters();
    renderCategoriesBar(categories,null);
    renderRecettesList(recettes);
    
    document.getElementById('recettesList').style.display='';
    document.getElementById('loader').style.display='none';
  })
  .catch(()=>{
    document.getElementById('loader').style.display='none';
    document.getElementById('recettesList').style.display='';
    document.getElementById('recettesList').innerHTML="<div style='color:var(--danger);text-align:center;font-size:1.2em;padding:40px 20px;'>‚ùå Impossible de charger les recettes.</div>";
  });
</script>
</body>
</html>
