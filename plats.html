<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Qook – Recettes</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{ --bg:#f7f8fa; --card:#fff; --accent:#15b79a; --accent-2:#0f9e85; --muted:#6c7780; --danger:#e74c3c; --radius:18px;}
*{box-sizing:border-box}
body,html{height:100%;margin:0;font-family:"Outfit",system-ui,-apple-system,"Segoe UI",Roboto,Arial;}
body{background:linear-gradient(180deg,var(--bg),#eef4f8);color:#132a31;padding-bottom:24px;}
.app{max-width:900px;margin:18px auto;padding:8px;}
header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
.brand{display:flex;gap:12px;align-items:center}
.logo{width:48px;height:48px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700}
.logo img{ width:50px; height:50px; display:block ; border-radius:10px;}
h1{font-size:17px;margin:0}
.card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 10px 30px rgba(17,36,45,0.05);border:1px solid rgba(15,25,30,0.03)}
.categories-bar{display:flex;gap:10px;margin-bottom:10px;overflow-x:auto;}
.cat-btn{padding:7px 18px;border-radius:10px;border:none;background:#fafdff;color:var(--muted);font-weight:600;cursor:pointer;font-size:15px;transition:.23s;white-space:nowrap;}
.cat-btn.active{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;}
.recettes-list{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
@media (max-width:800px){.recettes-list{grid-template-columns:1fr;gap:11px;}.app{padding:2px;}}
@media (max-width:560px){header{flex-direction:column;align-items:flex-start;gap:7px;}}
.recette-card{background:var(--card);border-radius:var(--radius);box-shadow:0 3px 14px rgba(18,160,127,0.07);border:1.4px solid #e6f9f4;padding:0 0 8px 0;overflow:hidden;}
.recette-card:hover{box-shadow:0 8px 20px rgba(21,183,154,.13);transform:translateY(-2px) scale(1.01);}
.recette-img{width:100%;height:170px;object-fit:cover;border-top-left-radius:var(--radius);border-top-right-radius:var(--radius);}
@media (max-width:600px){.recette-img{height:130px;}}
.recette-content{padding:13px 14px;}
.recette-title{font-size:1.18em;font-weight:600;color:#13333a;margin:0 0 8px;}
.recette-category{font-size:14px;color:var(--muted);font-weight:500;margin-bottom:3px;}
.recette-macros{font-size:15px;color:var(--accent);margin-bottom:6px;}
.section-sub{color:var(--muted);font-size:13px;letter-spacing:0.2px;margin-bottom:6px;}
.badge-fit{display:inline-block;margin:0 0 0 8px;padding:3px 11px;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;font-size:12px;border-radius:18px;font-weight:600;}
.badge-leger{background:linear-gradient(90deg,#cccccc 10%,#a0eed7 83%);}
.badge-prot{background:linear-gradient(90deg,#fe877e 6%,#deefa6 90%);}
.badge-objectif{background:linear-gradient(90deg,#15b79a,#7a70df);}
ul.ingredient-list{margin:0 0 0 1.1em;padding:0;font-size:15px;}
ul.ingredient-list li{margin-bottom:3px;}
.steps-list{padding:0;margin:0;list-style-type:decimal;font-size:14px;}
.steps-list li{margin-bottom:5px;}
.recette-actions{margin-top:12px;display:flex;gap:7px;align-items:center;}
.btn{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;padding:10px 13px;border-radius:9px;border:none;font-weight:700;cursor:pointer;font-size:16px;}
.btn.fav {font-size:19px;padding:0 11px;background:transparent;color:var(--muted);border:none;}
.btn.fav.active{color:#fcc827;background:transparent}
.goal-notice{color:#0f9e85;font-weight:600;background:#e6f9f4;border-radius:8px;padding:7px 14px;margin-bottom:14px;font-size:14px;border:1px solid #c0e5dd;}
.recette-temps{ font-size:13px;color:var(--accent-2);font-weight:600;margin-bottom:7px;background:#fafdff;border-radius:6px;padding:2.5px 8px;display:inline-block;}
#searchBar {width:100%;padding:10px 12px;margin-bottom:12px;border-radius:10px;border:1px solid #ccc;font-size:15px;}
.suggestions-carousel{display:flex;overflow-x:auto;gap:12px;margin-bottom:12px;padding-bottom:6px;scroll-behavior:smooth;}
.suggestion-card{flex:0 0 auto;width:200px;background:var(--card);border-radius:12px;box-shadow:0 3px 14px rgba(18,160,127,0.07);border:1.4px solid #e6f9f4;cursor:pointer;transition:0.23s;}
.suggestion-card:hover{transform:translateY(-2px) scale(1.02);box-shadow:0 8px 20px rgba(21,183,154,.13);}
.suggestion-card img{width:100%;height:120px;object-fit:cover;border-top-left-radius:12px;border-top-right-radius:12px;}
.suggestion-card .suggestion-title{padding:8px 10px;font-weight:600;font-size:15px;color:#13333a;}
</style>
</head>
<body>
<div class="app">
<header>
<div class="brand">
<div class="logo" aria-hidden="true" title="Nutrition">
<img src="https://firebasestorage.googleapis.com/v0/b/justfit-bed28.firebasestorage.app/o/logoapp.jpg?alt=media&token=85987921-9c3a-445a-979d-9662c2d17e93" alt="Logo SN" />
</div>
<div>
<h1>Recettes</h1>
<p class="hint">Retrouve ici un large choix de recettes avec leur préparation</p>
</div>
</div>
<div style="display:flex;gap:8px">
<a href="index.html" class="btn ghost" style="text-decoration:none;color:inherit">Retour</a>
</div>
</header>
<main>
<section class="card">
<div id="userGoalNotice" class="goal-notice" style="display:none"></div>
<input type="text" id="searchBar" placeholder="Rechercher un plat..."/>
<div class="suggestions-carousel" id="suggestionsCarousel"></div>
<div class="categories-bar" id="categoriesBar"></div>
<div class="recettes-list" id="recettesList"></div>
<div id="loader" style="width:56px;height:56px;border-radius:50%;border:6px solid #e7f8f3;border-top:6px solid var(--accent);animation: spin 0.9s linear infinite;margin:auto;margin-top:48px;display:none;"></div>
<style>@keyframes spin{to{transform:rotate(360deg);}}</style>
</section>
</main>
</div>
<script>
// Fonctions de favoris et filtre
function getFavList(){try{return JSON.parse(localStorage.getItem('sn_v2_fav_recipes')||'[]');}catch(e){return[];}}
function setFavList(arr){try{localStorage.setItem('sn_v2_fav_recipes',JSON.stringify(arr));}catch(e){}
}
function isFav(nom){return getFavList().includes(nom);}
function toggleFav(nom){let favs=getFavList();if(favs.includes(nom)){favs=favs.filter(f=>f!==nom);}else{favs.push(nom);}setFavList(favs);renderRecettesList(currentPlats,currentCat,document.getElementById('searchBar').value);}
function filtreNonVeg(list){return list.filter(r=>!(r.categorie&&r.categorie.toLowerCase().includes("végétarien")||r.categorie.toLowerCase().includes("vegan"))&&!(r.nom&&r.nom.toLowerCase().includes("vegan"))&&!(r.type&&(r.type=="vegan"||r.type=="vegetarien"||r.type=="plat végétarien"))&&typeof r.image=="string"&&r.image.length>0);}
function getUserGoal(){let goal=2000;try{const profileStr=localStorage.getItem('sn_v2_profile');if(profileStr){const profile=JSON.parse(profileStr);if(profile.goalCalories&&profile.goalCalories>100){goal=profile.goalCalories;}}}catch(e){}return goal;}
let userCalGoal=getUserGoal();document.getElementById("userGoalNotice").style.display="block";document.getElementById("userGoalNotice").innerHTML=`Ton objectif calorique est <strong>${userCalGoal} kcal</strong>.<br>Les plats affichés sont adaptés à ton besoin!`;

let currentCat=null,currentPlats=null;

function renderCategoriesBar(categories,activeType){const bar=document.getElementById('categoriesBar');bar.innerHTML='';categories.forEach(cat=>{bar.innerHTML+=`<button class="cat-btn${activeType===cat.type?' active':''}" data-type="${cat.type}">${cat.label}</button>`;});Array.from(bar.querySelectorAll('.cat-btn')).forEach(btn=>{btn.onclick=()=>{currentCat=btn.dataset.type;renderRecettesList(currentPlats,currentCat,document.getElementById('searchBar').value);renderCategoriesBar(categories,currentCat);}});}

function renderSuggestions(plats){const carousel=document.getElementById('suggestionsCarousel');carousel.innerHTML='';plats.slice(0,10).forEach(p=>{carousel.innerHTML+=`<div class="suggestion-card" onclick="scrollToRecette('${p.nom}')"><img src="${p.image}"/><div class="suggestion-title">${p.nom}</div></div>`;});}

function scrollToRecette(nom){const el=[...document.querySelectorAll('.recette-title')].find(e=>e.textContent.includes(nom));if(el)el.scrollIntoView({behavior:'smooth',block:'center'});}

function badgeFor(rec,goal){if(!rec.macros)return"";const cal=rec.macros.cal;let badges=[];if(rec.type=="plat"&&cal>=goal*0.2&&cal<=goal*0.5)badges.push(`<span class="badge-fit badge-objectif">Objectif ~${Math.round(100*cal/goal)}%</span>`);if(cal<=110&&(rec.type=="entree"||rec.type=="dessert"))badges.push(`<span class="badge-fit badge-leger">Léger</span>`);if(rec.macros.p&&rec.macros.p>=20)badges.push(`<span class="badge-fit badge-prot">Protéiné</span>`);if(rec.type=="boisson")badges.push(`<span class="badge-fit badge-leger">Boisson</span>`);return badges.join('');}

function renderRecettesList(list,typeFilter='',search=''){const goal=userCalGoal;const plats=filtreNonVeg(list);currentPlats=plats;const container=document.getElementById('recettesList');container.innerHTML='';let filtered=plats;if(typeFilter)filtered=filtered.filter(r=>r.type===typeFilter);if(search)filtered=filtered.filter(r=>r.nom.toLowerCase().includes(search.toLowerCase()));filtered.forEach(recette=>{const macros=recette.macros?`${recette.macros.cal}kcal • ${recette.macros.p}g P • ${recette.macros.c}g C • ${recette.macros.f}g L`:'';const favActive=isFav(recette.nom)?'active':'';const temps=recette.temps?`<span class="recette-temps">⏱ ${recette.temps} min</span>`:'';container.innerHTML+=`<div class="recette-card"><img src="${recette.image}" alt="Image ${recette.nom}" class="recette-img" loading="lazy"/><div class="recette-content"><div class="recette-title">${recette.nom} ${badgeFor(recette,goal)}</div><div class="recette-category">${recette.categorie}</div>${temps}<div class="recette-macros">${macros}</div><div class="section-sub">Ingrédients :</div><ul class="ingredient-list">${recette.ingredients.map(ing=>`<li>${ing}</li>`).join('')}</ul><div class="section-sub" style="margin-top:8px;">Préparation :</div><ol class="steps-list">${recette.etapes.map((e,i)=>`<li>${e}</li>`).join('')}</ol><div class="recette-actions"><button class="btn" onclick="copyRecette('${recette.nom}')">Copier recette</button><button class="btn fav ${favActive}" onclick="toggleFav('${recette.nom}')" title="Mettre en favoris">${favActive?"★":"☆"}</button></div></div></div>`;});renderSuggestions(filtered);}

window.copyRecette=function(nom){const recette=currentPlats.find(r=>r.nom===nom);if(!recette)return;const text=`${recette.nom}\nCatégorie: ${recette.categorie}\nMacros: ${recette.macros?.cal}kcal, ${recette.macros?.p}g P, ${recette.macros?.c}g C, ${recette.macros?.f}g L\nTemps: ${recette.temps||'-'} min\n\nIngrédients:\n- ${recette.ingredients.join('\n- ')}\n\nPréparation:\n${recette.etapes.map((e,i)=>`${i+1}. ${e}`).join('\n')}`;navigator.clipboard.writeText(text).then(()=>alert("Recette copiée !"));}

// Recherche
document.getElementById('searchBar').addEventListener('input',e=>renderRecettesList(currentPlats,currentCat,e.target.value));

// Chargement JSON
document.getElementById('recettesList').style.display='none';document.getElementById('loader').style.display='';
fetch('recettes.json').then(resp=>resp.json()).then(data=>{const recettes=filtreNonVeg(data);currentPlats=recettes;const categories=Object.entries(recettes.reduce((acc,r)=>{acc[r.categorie]=r.type;return acc;},{})).map(([label,type])=>({label,type}));currentCat=categories[0]?categories[0].type:null;renderCategoriesBar(categories,currentCat);renderRecettesList(recettes,currentCat);document.getElementById('recettesList').style.display='';document.getElementById('loader').style.display='none';}).catch(()=>{document.getElementById('loader').style.display='none';document.getElementById('recettesList').style.display='';document.getElementById('recettesList').innerHTML="<div style='color:var(--danger);text-align:center;font-size:1.2em;'>Impossible de charger les recettes.</div>";});
</script>
</body>
</html>

