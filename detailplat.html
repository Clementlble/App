<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover,user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<title>Qook â€“ DÃ©tail Recette</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{ 
  --orange:#ff6347;
  --muted:#6c7780;
}

* {
  box-sizing:border-box;
  -webkit-tap-highlight-color: transparent;
}

body,html {
  height:100%;
  margin:0;
  font-family:"Outfit",system-ui,-apple-system,"Segoe UI",Roboto,Arial;
  -webkit-font-smoothing: antialiased;
  -webkit-text-size-adjust: 100%;
}

body {
  background:#fff;
  color:#132a31;
  padding-bottom:calc(24px + env(safe-area-inset-bottom));
  padding-top:env(safe-area-inset-top);
}

.container {
  max-width:600px;
  margin:0 auto;
  background:#fff;
  min-height:100vh;
}

.header-section {
  position:relative;
  padding:70px 20px 20px;
}

.back-btn {
  position:absolute;
  top:calc(20px + env(safe-area-inset-top));
  left:20px;
  width:44px;
  height:44px;
  border-radius:50%;
  background:linear-gradient(135deg, #ff6347, #ff8566);
  border:none;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  box-shadow:0 4px 16px rgba(255,99,71,0.4);
  transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  z-index:100;
  text-decoration:none;
  font-size:22px;
  font-weight:700;
  line-height:1;
  padding:0;
}

.back-btn:hover {
  transform:scale(1.1);
  box-shadow:0 6px 20px rgba(255,99,71,0.5);
}

.back-btn:active {
  transform:scale(0.95);
}

.servings-section {
  display:flex;
  align-items:center;
  justify-content:center;
  gap:16px;
  margin:0 20px 24px;
  padding:16px;
  background:#fff;
  border-radius:16px;
  box-shadow:0 2px 12px rgba(0,0,0,0.06);
}

.servings-label {
  font-size:15px;
  font-weight:600;
  color:#333;
}

.servings-controls {
  display:flex;
  align-items:center;
  gap:16px;
  background:#f8f9fa;
  padding:8px 16px;
  border-radius:12px;
}

.servings-btn {
  width:36px;
  height:36px;
  border-radius:50%;
  border:none;
  background:linear-gradient(135deg, #ff6347, #ff8566);
  color:#fff;
  font-size:20px;
  font-weight:700;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:all 0.3s;
  box-shadow:0 2px 8px rgba(255,99,71,0.3);
}

.servings-btn:hover {
  transform:scale(1.1);
}

.servings-btn:active {
  transform:scale(0.95);
}

.servings-btn:disabled {
  opacity:0.4;
  cursor:not-allowed;
  transform:scale(1);
}

.servings-value {
  font-size:22px;
  font-weight:700;
  color:#ff6347;
  min-width:40px;
  text-align:center;
}

.recipe-title {
  font-size:28px;
  font-weight:800;
  color:#1a1a1a;
  margin:0 0 20px 0;
  line-height:1.2;
  padding-right:50px;
}

.recipe-image {
  width:100%;
  height:250px;
  object-fit:cover;
  border-radius:16px;
  margin-bottom:20px;
}

.macros-grid {
  display:grid;
  grid-template-columns:repeat(4, 1fr);
  gap:12px;
  margin:0 20px 32px;
  padding:20px;
  background:linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
  border-radius:20px;
  box-shadow:0 4px 20px rgba(0,0,0,0.06);
}

.macro-item {
  text-align:center;
  padding:16px 8px;
  background:#fff;
  border-radius:16px;
  box-shadow:0 2px 12px rgba(0,0,0,0.04);
  transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position:relative;
  overflow:hidden;
}

.macro-item::before {
  content:'';
  position:absolute;
  top:0;
  left:0;
  right:0;
  height:3px;
  opacity:0.8;
}

.macro-item:hover {
  transform:translateY(-4px);
  box-shadow:0 8px 24px rgba(0,0,0,0.1);
}

.macro-value {
  font-size:26px;
  font-weight:800;
  line-height:1;
  margin-bottom:8px;
  display:block;
}

.macro-unit {
  font-size:11px;
  font-weight:700;
  color:#999;
  display:block;
  margin-top:4px;
  text-transform:uppercase;
  letter-spacing:0.5px;
}

.macro-label {
  font-size:11px;
  color:#666;
  font-weight:600;
  text-transform:uppercase;
  letter-spacing:0.5px;
}

.tabs {
  display:flex;
  gap:12px;
  margin-bottom:20px;
  border-bottom:2px solid #f0f0f0;
  padding:0 20px;
}

.tab {
  padding:12px 24px;
  border:none;
  background:transparent;
  color:#666;
  font-weight:600;
  font-size:15px;
  cursor:pointer;
  transition:all 0.3s;
  border-bottom:3px solid transparent;
  margin-bottom:-2px;
}

.tab.active {
  color:var(--orange);
  border-bottom-color:var(--orange);
}

.content-section {
  padding:0 20px 24px;
}

.tab-content {
  display:none;
}

.tab-content.active {
  display:block;
  animation:fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity:0; transform:translateY(10px); }
  to { opacity:1; transform:translateY(0); }
}

.ingredient-item {
  display:flex;
  align-items:center;
  gap:12px;
  padding:14px;
  background:#fff;
  border-radius:12px;
  margin-bottom:10px;
  border:1px solid #f0f0f0;
}

.ingredient-icon {
  width:36px;
  height:36px;
  font-size:24px;
  display:flex;
  align-items:center;
  justify-content:center;
}

.ingredient-info {
  flex:1;
}

.ingredient-name {
  font-size:15px;
  font-weight:600;
  color:#1a1a1a;
}

.ingredient-quantity {
  font-size:13px;
  color:#999;
  text-align:right;
  font-weight:500;
}

.instruction-item {
  margin-bottom:20px;
}

.instruction-header {
  display:flex;
  align-items:flex-start;
  gap:12px;
}

.instruction-number {
  width:32px;
  height:32px;
  background:var(--orange);
  color:#fff;
  border-radius:8px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
  font-size:16px;
  flex-shrink:0;
}

.instruction-text {
  flex:1;
  font-size:14px;
  color:#333;
  line-height:1.6;
  padding-top:4px;
}

@media (max-width:768px) {
  .recipe-title {
    font-size:24px;
  }

  .recipe-image {
    height:220px;
  }

  .macros-grid {
    gap:8px;
    padding:16px;
    margin:0 12px 28px;
  }

  .macro-item {
    padding:12px 6px;
  }

  .macro-value {
    font-size:22px;
  }

  .macro-unit {
    font-size:10px;
  }

  .macro-label {
    font-size:10px;
  }
}

@supports (padding: max(0px)) {
  body {
    padding-left: max(12px, env(safe-area-inset-left));
    padding-right: max(12px, env(safe-area-inset-right));
  }
}
</style>
</head>
<body>
<div class="container">
  <div class="header-section">
    <a href="plats.html" class="back-btn">â†</a>
    <h1 class="recipe-title" id="recipeTitle"></h1>
    <img class="recipe-image" id="recipeImage" src="" alt="Recipe"/>
  </div>

  <div class="servings-section">
    <span class="servings-label">Nombre de personnes :</span>
    <div class="servings-controls">
      <button class="servings-btn" onclick="changeServings(-1)" id="decreaseBtn">âˆ’</button>
      <span class="servings-value" id="servingsValue">1</span>
      <button class="servings-btn" onclick="changeServings(1)" id="increaseBtn">+</button>
    </div>
  </div>

  <div class="macros-grid" id="macrosGrid"></div>

  <div class="tabs">
    <button class="tab active" onclick="switchTab('ingredients')">IngrÃ©dients</button>
    <button class="tab" onclick="switchTab('instructions')">Instructions</button>
  </div>

  <div class="content-section">
    <div class="tab-content active" id="ingredientsTab"></div>
    <div class="tab-content" id="instructionsTab"></div>
  </div>
</div>

<script>
let currentServings = 1;
let originalRecette = null;

const ingredientIcons = {
  'yaourt': 'ğŸ¥›', 'gingembre': 'ğŸ§„', 'ail': 'ğŸ§„', 'citron': 'ğŸ‹', 'chaat': 'ğŸŒ¶ï¸', 
  'cumin': 'ğŸŒ¿', 'garam': 'ğŸŒ¶ï¸', 'piment': 'ğŸŒ¶ï¸', 'curcuma': 'ğŸŒ¿', 'sel': 'ğŸ§‚', 
  'huile': 'ğŸ«’', 'yogurt': 'ğŸ¥›', 'pÃ¢te': 'ğŸ§„', 'jus': 'ğŸ‹', 'poudre': 'ğŸŒ¿', 
  'ghee': 'ğŸ«’', 'poivre': 'ğŸŒ¶ï¸', 'sauce': 'ğŸ¥«', 'tomate': 'ğŸ…', 'oignon': 'ğŸ§…',
  'carotte': 'ğŸ¥•', 'poulet': 'ğŸ—', 'viande': 'ğŸ¥©', 'poisson': 'ğŸŸ', 'oeuf': 'ğŸ¥š',
  'fromage': 'ğŸ§€', 'beurre': 'ğŸ§ˆ', 'lait': 'ğŸ¥›', 'crÃ¨me': 'ğŸ¥›', 'riz': 'ğŸš',
  'pÃ¢tes': 'ğŸ', 'pain': 'ğŸ', 'farine': 'ğŸŒ¾', 'sucre': 'ğŸ¬', 'miel': 'ğŸ¯'
};

function getIngredientIcon(ingredient) {
  const lower = ingredient.toLowerCase();
  for (const [key, icon] of Object.entries(ingredientIcons)) {
    if (lower.includes(key)) return icon;
  }
  return 'ğŸ¥„';
}

function drawMacro(value, unit, label, color) {
  return `
    <div class="macro-item" style="color:${color}">
      <div class="macro-value">${value}</div>
      <div class="macro-unit">${unit}</div>
      <div class="macro-label">${label}</div>
    </div>
  `;
}

function switchTab(tab) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  
  event.target.classList.add('active');
  document.getElementById(tab + 'Tab').classList.add('active');
}

function parseQuantity(quantityStr) {
  // Extraire le nombre de la quantitÃ© (ex: "200g" -> 200, "1/2 cup" -> 0.5)
  const match = quantityStr.match(/(\d+\.?\d*|\d*\/\d+)/);
  if (!match) return null;
  
  const numStr = match[1];
  if (numStr.includes('/')) {
    const [num, den] = numStr.split('/').map(Number);
    return num / den;
  }
  return parseFloat(numStr);
}

function multiplyQuantity(quantityStr, multiplier) {
  const quantity = parseQuantity(quantityStr);
  if (quantity === null) return quantityStr;
  
  const newQuantity = quantity * multiplier;
  const unit = quantityStr.replace(/[\d\s\/\.]+/, '').trim();
  
  // Formater le nombre (arrondir si nÃ©cessaire)
  const formatted = newQuantity % 1 === 0 ? newQuantity : newQuantity.toFixed(1);
  
  return `${formatted} ${unit}`;
}

function changeServings(delta) {
  const newServings = currentServings + delta;
  if (newServings < 1 || newServings > 10) return;
  
  currentServings = newServings;
  document.getElementById('servingsValue').textContent = currentServings;
  
  // Mettre Ã  jour le bouton - (dÃ©sactiver si = 1)
  document.getElementById('decreaseBtn').disabled = currentServings === 1;
  document.getElementById('increaseBtn').disabled = currentServings === 10;
  
  // Recalculer et afficher les ingrÃ©dients
  renderIngredients();
  
  // Recalculer les macros
  renderMacros();
}

function renderMacros() {
  const macros = originalRecette.macros || {cal:320, p:30, c:20, f:15};
  const multiplier = currentServings;
  
  const macrosHtml = 
    drawMacro(Math.round(macros.cal * multiplier), 'kcal', 'Calories', '#4caf50') +
    drawMacro(Math.round(macros.c * multiplier), 'g', 'Glucides', '#ff9800') +
    drawMacro(Math.round(macros.p * multiplier), 'g', 'ProtÃ©ines', '#2196f3') +
    drawMacro(Math.round(macros.f * multiplier), 'g', 'Lipides', '#f44336');
  
  document.getElementById('macrosGrid').innerHTML = macrosHtml;
}

function renderIngredients() {
  const ingredientsHtml = originalRecette.ingredients.map(ing => {
    const parts = ing.split('-');
    const name = parts[0].trim();
    const quantity = parts[1]?.trim() || '1 portion';
    
    const adjustedQuantity = multiplyQuantity(quantity, currentServings);
    
    return `
      <div class="ingredient-item">
        <div class="ingredient-icon">${getIngredientIcon(name)}</div>
        <div class="ingredient-info">
          <div class="ingredient-name">${name}</div>
        </div>
        <div class="ingredient-quantity">${adjustedQuantity}</div>
      </div>
    `;
  }).join('');
  document.getElementById('ingredientsTab').innerHTML = ingredientsHtml;
}

// Charger la recette depuis sessionStorage
const recetteStr = sessionStorage.getItem('currentRecette');
if (!recetteStr) {
  window.location.href = 'plats.html';
} else {
  originalRecette = JSON.parse(recetteStr);
  
  // Titre et image
  document.getElementById('recipeTitle').textContent = originalRecette.nom;
  document.getElementById('recipeImage').src = originalRecette.image;
  document.getElementById('recipeImage').alt = originalRecette.nom;
  
  // Macros initiaux
  renderMacros();
  
  // IngrÃ©dients initiaux
  renderIngredients();
  
  // Instructions (ne changent pas avec le nombre de personnes)
  const instructionsHtml = originalRecette.etapes.map((step, i) => `
    <div class="instruction-item">
      <div class="instruction-header">
        <div class="instruction-number">${i + 1}</div>
        <div class="instruction-text">${step}</div>
      </div>
    </div>
  `).join('');
  document.getElementById('instructionsTab').innerHTML = instructionsHtml;
}
</script>
</body>
</html>
